# Weak Randomness and Entropy in MPC Wallet Key Generation and Signing

**Last Updated**: 2025-11-30  
**Status**: Draft  
**Owner**: Security Team

## Problem Statement

1. **[CRITICAL]** Q: MPC wallet providers and institutional users rely on high-quality randomness for distributed key generation and per-transaction signing nonces, but weak or improperly engineered entropy sources can silently produce predictable keys or nonces, enabling full private key recovery and catastrophic asset theft across wallets that were assumed to be protected by MPC.
   
   A:
   - **Brief description of the problem to be analyzed**: 
     MPC wallets promise that no single device ever holds the full private key, but this security model assumes that all key-generation and signing nonces are derived from strong entropy sources. Historical incidents in non-MPC wallets (Android SecureRandom bug, Profanity vanity address generator, Trust Wallet browser extension flaw, Blockchain Bandit weak keys, alleged LuBian mining pool theft) show that poor randomness alone can leak private keys and drain funds even when all other cryptography appears correct [Blog: Tangem, 2024; Article: The Register, 2013]. In MPC architectures, correlated entropy failures across cosigners or during distributed key generation (DKG) can undermine threshold guarantees at scale, exposing tens of billions in assets to silent compromise despite the appearance of distributed security.
   
   - **Background and current situation**: 
     Modern MPC wallets depend on randomness at multiple layers: (1) Distributed key generation protocols (GG18/GG20/CGGMP20/CGGMP21, FROST-style schemes) require each participant to generate high-entropy secrets and randomness contributions; (2) Per-signature nonces for ECDSA/Schnorr must be unique and unpredictable at each signing round; (3) Secure elements, TEEs (e.g., AWS Nitro Enclaves, mobile secure enclaves), and HSMs must expose high-quality hardware random number generators (HRNGs) to wallet software [Blog: Tangem, 2024; Blog: AWS Web3, 2024]. A decade of incidents in non-MPC environments demonstrates systemic entropy failures: Android SecureRandom bug allowed private key recovery for Bitcoin wallets by reusing ECDSA nonces in 2013 [Article: The Register, 2013]; the Profanity vanity address tool used only 32 bits of entropy, enabling attackers to brute-force Wintermute’s keys and steal ~$160M in 2022 [Blog: Halborn, 2022]; Trust Wallet’s browser extension generated seeds with roughly 32 bits of entropy, putting all wallets created during a multi-month window at risk until patched [Disclosure: Ledger, 2023]; the “Blockchain Bandit” monitored addresses derived from weak Ethereum keys and siphoned ~45,000 ETH over years [Case Study: ISE, 2019]; Arkham Intelligence alleges that 127,426 BTC stolen from LuBian mining pool may trace to predictable key generation [Report: Arkham Intelligence, 2025; Blog: Tangem, 2024]. In MPC settings, many cosigners still run in environments with software PRNGs seeded at startup, browser-based components, or cloud VMs with poorly monitored entropy pools, and there is no industry-wide standard for proving minimum entropy levels, testing RNG quality, or attesting to randomness sources used during DKG and signing.
   
   - **Goals and success criteria**: 
     Randomness quality: Ensure all production MPC key-generation ceremonies and signing operations use verifiably strong entropy sources providing ≥128 bits (min) / ≥192 bits (target) / ≥256 bits (ideal) of effective entropy per key and per nonce, measured via standardized statistical tests and hardware RNG certifications. Coverage: Reach 100% of MPC cosigners and key-generation endpoints under hardware-backed or formally validated RNG (current: many deployments rely on OS PRNGs and browser entropy, exact coverage unknown). Incident reduction: Reduce randomness-related wallet compromise incidents across the institution from “unquantified latent risk” to 0 per year, and across partner ecosystem from multiple historical incidents per decade → ≤1 incident/decade (min) / 0 incidents (target), as measured by post-incident root-cause analyses. Detection capability: Achieve continuous RNG health monitoring with detection latency <1 hour (min) / <15 minutes (target) / <5 minutes (ideal) from onset of RNG failure (e.g., stuck output, low-entropy pool) to alert, with automatic signing halt for affected cosigners. Key generation assurance: Achieve 100% of new MPC key-generation ceremonies producing attestations documenting entropy sources, hardware provenance, RNG health checks, and statistical test results, and make these available for audit by Q4 2026. Legacy key risk reduction: Identify and phase out legacy keys created with unverified or low-entropy sources such that ≥80% (min) / ≥95% (target) / 100% (ideal) of assets are protected by post-remediation keys by end of 2027.
   
   - **Key constraints and resources**: 
     Timeline: Q1 2025–Q4 2027 (12–18 months for RNG assessment and retrofitting, 24–36 months for full key migration where needed). Budget: Per major MPC provider, est. $500K–$1.5M for entropy audits, RNG hardware rollout, monitoring infrastructure, and key migration campaigns (covering secure element or HSM upgrades, TEEs, tooling, and staff time). Technology: Not all deployment environments have native HRNGs (e.g., some browser contexts, low-cost mobile devices, older HSMs); retrofitting may require new hardware, firmware upgrades, or architectural changes (moving critical randomness into secure elements / TEEs and feeding MPC protocols from those sources). Performance: Hardware RNGs and continuous health tests must not introduce unacceptable signing latency; randomness extraction and testing must complete within <50ms (min) / <20ms (target) per use so total MPC signing latency remains within existing 2–15s envelope [Guide: Stackup, 2025]. Backward compatibility: Many high-value keys already in production were created with opaque RNG properties; rotating or re-generating keys for institutional clients may require regulatory approvals, re-onboarding, operational downtime windows, and support for overlapping key usage during migration. Verification complexity: Proving “sufficient entropy” is non-trivial; statistical tests can detect gross failures but cannot fully guarantee unpredictability, and integrating hardware attestation (e.g., secure element HRNG self-tests, TEE attestation) into MPC protocols requires new tooling. Organizational: Cryptography and infrastructure teams must coordinate across mobile, backend, HSM, TEE, and browser components; some third-party SDKs and vendors may resist exposing low-level randomness details or changing implementations.
   
   - **Stakeholders and roles**: 
     MPC Wallet Providers (10–20 major vendors, need verifiable entropy guarantees to maintain security claims, constraint: RNG overhaul adds hardware costs and engineering complexity). Institutional Custody Clients (hundreds of funds, exchanges, corporate treasuries controlling $10B–$100B+ collectively, need assurance that key material and nonces are not predictable, constraint: key rotation and migration cause operational risk and regulatory overhead). End Users – Retail and Prosumer (millions of users indirectly affected by provider RNG choices, need safe wallets without understanding entropy, constraint: no appetite for complex recovery or migrations just to fix invisible randomness issues). Hardware Wallet and Secure Element Vendors (need to provide certified HRNGs and attestation APIs consumable by MPC software, constraint: silicon design cycles and certification (e.g., FIPS 140-2/3, CC) take 1–3 years). Cloud and TEE Providers (AWS, GCP, Azure, mobile TEE platforms, need to expose and document high-quality randomness sources and attestation hooks for Nitro Enclaves, SGX-like TEEs, etc., constraint: shared across many customers and products, cryptographic wallet use cases are only a subset). Security & Cryptography Teams (within wallet vendors and institutions, responsible for RNG design/validation, constraint: limited specialized expertise and competing security priorities such as side-channel resistance and supply chain). Regulators and Auditors (must evaluate custody security including randomness, constraint: limited internal cryptography expertise, rely on standards and third-party certifications rather than bespoke arguments). Insurance Providers (underwrite custody risk, need quantitative understanding of key-compromise vectors including entropy failures, constraint: little actuarial data specifically for randomness-related incidents).
   
   - **Time scale and impact scope**: 
     Time scale: Threat is ongoing and long-lived; randomness weaknesses can remain latent for years until discovered or exploited (Android SecureRandom collisions observed months before public disclosure; Profanity and Trust Wallet flaws existed for months to years before fixes) [Article: The Register, 2013; Blog: Tangem, 2024]. Once weak keys are generated, risk persists indefinitely until keys are rotated and funds moved. Systems: All MPC key-management components (distributed key generation ceremonies, cosigner services, mobile/desktop clients, HSMs, TEEs, secure elements, browser-based signers, randomness extraction libraries, monitoring and logging for RNG health). Impact: Potentially systemic—entropy failures can compromise entire classes of keys (all wallets created on a flawed Android version, all addresses generated by Profanity, all seeds from a flawed browser extension, or entire MPC deployments using a misconfigured PRNG), exposing hundreds of thousands of addresses and billions in assets [Blog: Tangem, 2024]. Geographies: Global, as randomness implementations are typically shared via libraries and firmware images rather than localized deployments. Use cases: Hot wallets, warm wallets, and even cold or semi-offline systems that rely on software entropy during initial key generation or subsequent signing; especially critical for high-value institutional custody and market-making operations.
   
   - **Historical attempts and existing solutions (if any)**: 
     2013 Android SecureRandom incident: Bitcoin developers worked around weak Java SecureRandom on Android by bypassing the platform PRNG and sourcing randomness from `/dev/urandom`, then urging users to regenerate wallets, illustrating how RNG fixes often require both code changes and key migration [Article: The Register, 2013]. 2018–2019: Research on weak ECDSA nonces and Ethereum key scanning (“Blockchain Bandit”) showed large-scale exploitation of predictably generated keys and addresses in the wild [Case Study: ISE, 2019]. 2022 Profanity hack: Security researchers and affected projects recommended abandoning Profanity and migrating away from vanity addresses created with low-entropy seeds [Blog: Halborn, 2022]. 2023 Trust Wallet browser extension flaw: Developers patched the RNG issue and reimbursed some users, but all seeds created during the vulnerability window were permanently suspect, highlighting the difficulty of retroactively proving key safety [Disclosure: Ledger, 2023]. Hardware vendors and secure-element-based wallets advocate HRNGs and in-chip key generation, with continuous self-tests and FIPS-style certifications to guarantee entropy quality [Blog: Tangem, 2024]. Some MPC and custody providers are beginning to integrate TEEs (e.g., AWS Nitro Enclaves) to protect both key shares and RNG state, using attestation to tie signing to specific enclave images and configurations [Blog: AWS Web3, 2024]. However, there is still no widely adopted standard for: (1) proving entropy quality during MPC DKG and signing, (2) logging and attesting randomness sources per key or per signing session, or (3) systematically identifying and migrating legacy weak keys across heterogeneous MPC deployments.
   
   - **Known facts, assumptions, and uncertainties**: 
     - **Facts**: Android’s SecureRandom implementation produced weak nonces for ECDSA signatures in early Bitcoin wallets, allowing private key recovery and theft until developers switched to stronger randomness sources [Article: The Register, 2013]. Multiple high-profile crypto thefts and risks (IOTA seed generator website theft ~$4M, Blockchain Bandit’s ~45,000 ETH, Wintermute’s ~$160M loss linked to Profanity’s 32-bit entropy, Trust Wallet browser extension seeds with ~32 bits of entropy, alleged LuBian pool theft of 127,426 BTC) have been linked to predictable or low-entropy key generation and nonces [Blog: Tangem, 2024]. ECDSA and Schnorr signatures are mathematically fragile to nonce reuse or predictability—if a nonce is reused or guessable, private keys can often be reconstructed from public signatures [Blog: Tangem, 2024]. Browser and JavaScript environments have well-known entropy limitations; APIs like `Math.random()` are not cryptographically secure, and even `crypto.getRandomValues()` ultimately depends on the host system’s entropy pool [Blog: Tangem, 2024]. Hardware RNGs in secure elements and HSMs can provide high-quality entropy and perform continuous health tests, and are widely recommended by cryptographers for key generation [Blog: Tangem, 2024]. MPC DKG and signing protocols assume access to strong randomness at each participant; if this assumption fails, security proofs no longer apply even if the protocol is implemented correctly [Guide: Stackup, 2025].
     - **Assumptions**: Industry-wide, hundreds of thousands to millions of keys may have been generated with suboptimal entropy in the last decade, but only a subset has been exploited or publicly reported (inferred from the number of incidents collated in randomness-focused retrospectives) [Blog: Tangem, 2024]. MPC wallet deployments today likely inherit the same entropy risks as non-MPC wallets, since many reuse OS PRNGs, cryptographic libraries, or browser components originally designed for single-key wallets. The total value at risk from potential entropy failures in MPC deployments is at least in the tens of billions of dollars, given that multiple major custodians and exchanges depend on MPC architectures. Implementing comprehensive RNG monitoring, attestation, and key migration for large institutions will require months to years of engineering effort and coordination, making quick, industry-wide remediation unlikely. Some MPC providers may underestimate entropy risk because they have not yet experienced a publicly known RNG-related breach, leading to underinvestment in randomness-hardening.
     - **Uncertainties**: The true number and value of wallets compromised via weak randomness is unknown—many incidents may never be detected or disclosed, especially if attackers move funds slowly or target lesser-known addresses. It is unclear how many MPC deployments currently rely on browser-based components, startup-starved PRNGs, or non-certified RNG sources, since vendors rarely publish detailed RNG architectures. The alleged LuBian theft’s root cause remains unproven; if confirmed as an entropy issue, it would dramatically increase the perceived scale of randomness risk. No consensus yet exists on minimum acceptable entropy levels, testing regimes, or attestation formats for MPC-specific randomness (e.g., per-DKG vs. per-signature proofs). It is unknown how regulators will eventually treat entropy failures in custody audits—whether they will demand certified hardware RNGs, formal proofs, or only high-level assurances. The practical feasibility and performance impact of integrating fine-grained randomness attestation into high-throughput MPC signing workflows (e.g., thousands of transactions per hour) remains to be validated at scale.

---

## Glossary

- **Entropy (cryptographic)**: Measure of unpredictability in random values used for generating keys and nonces; high entropy means attackers cannot feasibly guess or brute-force the values.
- **Hardware Random Number Generator (HRNG)**: Physical random number generator embedded in secure elements, HSMs, or TEEs that derives entropy from physical phenomena (thermal noise, jitter) and can self-test for bias or failure.
- **Nonce (ECDSA/Schnorr)**: One-time random value used during creation of each digital signature; reuse or predictability of nonces can allow attackers to recover the long-term private key from observed signatures.
- **Distributed Key Generation (DKG)**: MPC protocol in which multiple parties collaboratively generate shares of a private key without any party ever reconstructing the full key, heavily reliant on each party’s randomness.
- **Secure element**: Tamper-resistant chip that generates, stores, and uses cryptographic keys internally, often with built-in HRNG and self-testing; used in hardware wallets and some MPC deployments.
- **Android SecureRandom bug**: 2013 vulnerability where Java’s `SecureRandom` on Android devices produced low-entropy values, leading to ECDSA nonce reuse and private key recovery for Bitcoin wallets.
- **Profanity vanity address tool**: Open-source Ethereum vanity address generator that used only 32 bits of entropy for seeds, allowing attackers to brute-force private keys and steal ~$160M from Wintermute and others.
- **Blockchain Bandit**: Pseudonymous attacker identified by researchers for systematically scanning for weak Ethereum keys and draining funds from addresses generated with poor entropy.
- **RNG health monitoring**: Continuous checks (statistical tests, sanity thresholds, hardware self-tests) to detect failures or degradation in random number generators before they cause exploitable weaknesses.
- **Attestation (TEE/secure element)**: Cryptographic proof from hardware that code is running in a particular trusted environment and, optionally, that specific configurations (including RNG setup) are in place.

---

## Reference

### Technical Guides & Cryptography Background
- [Guide: Stackup, 2025] - "MPC Wallets: A Complete Technical Guide" – Describes MPC architectures, performance characteristics (2–15s signing latency), and reliance on correct cryptographic assumptions including randomness.
- [Blog: Tangem, 2024] - "Old Wallets, Weak Keys: How Poor Entropy Still Drains Millions in Crypto" – Survey of major entropy-related wallet failures (Android SecureRandom, IOTA seed generator, Blockchain Bandit, Profanity, Trust Wallet, alleged LuBian case).

### Historical Incidents & Case Studies
- [Article: The Register, 2013] - "Android bug batters Bitcoin wallets" – Explains how Android’s SecureRandom flaw enabled ECDSA nonce reuse and private key recovery in early Bitcoin wallets.
- [Case Study: ISE, 2019] - "Ethercombing: Finding Secrets in Popular Places" – Documents the Blockchain Bandit’s exploitation of weak Ethereum private keys and associated ETH theft.
- [Blog: Halborn, 2022] - "Explained: The Profanity Address Generator Hack" – Analyzes how Profanity’s 32-bit entropy enabled brute-forcing of Ethereum vanity address keys, leading to ~$160M loss by Wintermute and others.
- [Disclosure: Ledger, 2023] - "Funds of Every Wallet Created with the Trust Wallet Browser Extension Could Have Been Stolen" – Details the low-entropy seed generation flaw (~32 bits) in Trust Wallet’s browser extension and subsequent remediation.
- [Report: Arkham Intelligence, 2025] - Analysis alleging that the theft of 127,426 BTC from LuBian mining pool may be attributable to predictable key generation, pending independent verification.

### Hardware RNGs, TEEs, and Secure Elements
- [Blog: Tangem, 2024] - Sections on hardware random number generators, secure elements, and standards for entropy testing and certification.
- [Blog: AWS Web3, 2024] - "Build secure multi-party computation (MPC) wallets using AWS Nitro Enclaves" – Describes using Nitro Enclaves and AWS KMS attestation to protect key shards and associated cryptographic material in MPC cosigner architectures.

### Standards and Best Practices
- Cryptographic standards and guidance recommending hardware-based entropy sources and RNG validation for key generation (e.g., FIPS 140-2/140-3 HRNG requirements, NIST SP 800-90 series) – referenced as general best practice for secure randomness.
