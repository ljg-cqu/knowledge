# Secure Enclave (TEE) Dependency and Portability Risk in MPC Wallet Architectures

**Last Updated**: 2025-11-30  
**Status**: Draft  
**Owner**: Security & Infrastructure Architecture Team

## Problem Statement

1. **[Important]** Q: MPC wallet providers increasingly depend on cloud and hardware Trusted Execution Environments (TEEs) such as AWS Nitro Enclaves, Intel SGX, AMD SEV, and ARM TrustZone to host MPC cosigners and key-share nodes, creating concentration, portability, and vulnerability risks where a single TEE platform flaw, attestation failure, deprecation decision, or regional outage can simultaneously degrade security and availability for millions of users and tens of billions of dollars in digital assets. Formulate a structured problem statement using the following [Input] fields.
   
   A:
   - **Brief description of the problem to be analyzed**: 
     MPC wallets use TEEs and secure enclaves to isolate MPC cosigner processes and protect key shares from host compromise, but this shifts critical trust from purely cryptographic guarantees to specific CPU vendors and cloud platforms. Providers such as Fireblocks run customer MPC cosigners inside AWS Nitro Enclaves with remote attestation and KMS-bound keys [Blog: AWS Web3, 2025-11], while Blockdaemon hosts MPC nodes for its Institutional Wallet and Builder Vault inside secure enclaves that rely on TEE isolation and attestation [Blog: Blockdaemon, 2025-11]. At the same time, TEEs have repeatedly been affected by speculative-execution side-channel vulnerabilities (Meltdown, Spectre, Foreshadow/L1TF) requiring microcode and OS patches and, in some cases, reducing effective security guarantees for Intel SGX [Advisory: CISA, 2018; Article: Anjuna, 2018]. This creates three coupled risks for MPC architectures: (1) **Concentration risk** where 60-80% of new institutional MPC deployments are estimated to run on a small number of TEE platforms (AWS Nitro, Intel SGX-based clouds) so that a single TEE-class vulnerability or attestation break could undermine isolation for a large fraction of deployments [Assumption]; (2) **Portability risk** where enclave code, attestation flows, and KMS bindings are tightly coupled to a specific cloud provider and CPU, making it slow and costly to migrate MPC cosigners to alternate TEEs or non-TEE environments during incidents; (3) **Lifecycle risk** where deprecation (Intel discontinuing SGX on many consumer CPUs), region restrictions, or regulatory changes affecting attestation keys can force redesigns under time pressure.
   
   - **Background and current situation**: 
     MPC threshold-signature architectures typically split keys across n parties (e.g., 2-of-3, 3-of-5) and run at least one share in a hardened environment. Cloud providers now promote TEEs as the primary way to host these cosigners: AWS describes Fireblocks customer MPC cosigners running inside Nitro Enclaves, using enclave attestation and KMS-bound keys to ensure that only approved enclave images can decrypt key shards and transient state [Blog: AWS Web3, 2025-11]. Nitro Enclaves provide isolated VMs without persistent storage; data must be kept in encrypted in-memory databases and periodically synchronized to S3 or DynamoDB using keys derived via KMS APIs that validate attestation documents [Blog: AWS Web3, 2025-11]. Blockdaemon emphasizes that its secure enclaves (TEE-based) keep MPC nodes’ secrets hidden from the host OS and use remote attestation plus "secret injection" to deliver sensitive material only to verified enclave instances, marketing this as "industry leading key protection" for Institutional Wallet and Builder Vault [Blog: Blockdaemon, 2025-11]. Developer guides compare MPC to TEE-based approaches, highlighting that TEEs can offer lower latency and richer integration with passwordless/social login flows but introduce new trust assumptions and vendor lock-in [Guide: Alchemy, 2025]. In parallel, public vulnerability research has shown that TEEs rely on complex CPU microarchitecture that is susceptible to side-channel and speculative-execution attacks such as Meltdown and Spectre; security advisories note that these flaws allow attackers with local code execution to read protected memory, affecting enclaves on impacted CPUs [Advisory: CISA, 2018; Article: Anjuna, 2018]. Intel SGX has seen multiple rounds of patches and guidance for enclave hardening, and its availability has been reduced on general-purpose CPUs, pushing operators toward server-skewed SKUs or alternative TEEs [Article: Anjuna, 2018]. As a result, MPC wallet providers are caught between using TEEs to harden against traditional server compromises and inheriting new, less transparent hardware-level risks and migration challenges.
   
   - **Goals and success criteria**: 
     TEE dependency and portability risks should be reduced without sacrificing MPC wallet security or performance. Measurable goals include: **Platform diversity**: Decrease the share of institutional MPC deployments where a quorum of MPC signing shares (e.g., 2-of-3 or 3-of-5) all reside on a single TEE platform from an estimated 70% (current, inferred from AWS Nitro and SGX adoption patterns) to <30% (min) / <20% (target) / <10% (ideal) by Q4 2027 [Assumption]. **Portability and migration**: Achieve the ability to re-host MPC cosigners from one TEE provider to another (e.g., from Nitro to an alternative TEE or to hardened non-TEE hosts) within <30 days (min) / <7 days (target) / <72 hours (ideal) of a critical vulnerability disclosure or attestation outage, including image rebuilds, attestation changes, and KMS key re-binding (baseline: 3-6 months for large providers to redesign and migrate enclave architectures) [Assumption]. **Security guarantees**: Maintain or improve isolation properties such that there are 0 confirmed incidents of enclave boundary compromise leading directly to MPC key-share theft across major providers from Q1 2026–Q4 2028, while still adopting mitigation patches for CPU vulnerabilities within <14 days (min) / <7 days (target) of vendor guidance [Advisory: CISA, 2018; Assumption]. **Standardization**: Establish at least one open, vendor-neutral specification for MPC cosigner enclave attestation and key-binding flows (covering identity measurement, PCR semantics, and secret injection protocols) adopted by ≥3 major MPC providers and ≥2 cloud or hardware TEE platforms by Q4 2027. **Transparency**: Require public documentation of TEE dependencies (platform, attestation root, isolation assumptions) and patch SLAs for ≥80% of institutional MPC wallet products by Q4 2026, improving due diligence for institutional clients and regulators.
   
   - **Key constraints and resources**: 
     Technical constraints include tight coupling between enclave code and specific platform APIs: Nitro Enclaves use vsock, Nitro-attested KMS calls, and specific PCR measurements; Intel SGX and AMD SEV/SEV-SNP use different attestation mechanisms, enclave loaders, and memory models; ARM TrustZone on mobile devices exposes yet another vendor-specific TEE API surface [Blog: AWS Web3, 2025-11; Blog: Blockdaemon, 2025-11]. Rewriting MPC cosigner logic to target multiple TEEs or to run in both TEE and non-TEE hardened modes requires significant engineering effort (3–6 engineers for 6–12 months per provider) and deep expertise in each platform’s security model [Assumption]. Performance and resource constraints also apply: TEEs often have limited memory and CPU, and enclave context switches and encrypted I/O impose overhead that can add 10–50% latency to MPC signing if not carefully optimized [Guide: Alchemy, 2025; Assumption]. Operational constraints include cloud-region availability (Nitro Enclaves only in certain AWS regions, SGX-enabled instances in limited data centers), and compliance constraints where regulators or customers may require specific regions or prohibit certain hardware vendors. Business constraints: cloud providers are incentivized to keep TEE stacks proprietary to maintain differentiation, while MPC vendors benefit from deep integration (attestation-bound KMS keys, monitoring, auto-scaling) that increases switching costs. Resource constraints: there are relatively few engineers with combined MPC, enclave, and cloud-security expertise (estimated <300 globally), and side-channel-resistant enclave coding requires additional training [Assumption].
   
   - **Stakeholders and roles**: 
     MPC Wallet Providers (Fireblocks, BitGo, Coinbase WaaS, Web3Auth, institutional custody platforms) rely on TEEs to secure cosigner shares and need strong isolation with acceptable latency and clear migration paths; they are constrained by limited enclave expertise, tight roadmaps, and pressure to ship features quickly. Cloud Providers and CPU Vendors (AWS with Nitro, Intel SGX, AMD SEV, ARM TrustZone implementers) design and operate TEEs; they need to balance performance, cost, and security while responding to vulnerabilities and may not prioritize crypto-specific use cases. Institutional Clients (exchanges, funds, banks, fintechs) depend on MPC wallet backends and require assurances that TEE vulnerabilities or deprecations will not freeze assets or silently weaken isolation; they have limited visibility into enclave configurations and attestation roots. Regulators and Auditors (securities regulators, banking supervisors, SOC 2 auditors) increasingly review custody architectures and must understand TEE-based threat models to assess systemic risk; their constraints include limited in-house hardware-security expertise and evolving standards. Security Researchers and Audit Firms (academic labs, NCC Group, Trail of Bits, others) analyze TEE vulnerabilities and MPC implementations; they need access to enclave code, reproducible builds, and disclosure channels while respecting NDAs and responsible disclosure timelines.
   
   - **Time scale and impact scope**: 
     Timeframe: Q1 2026–Q4 2028 is a realistic window to redesign MPC cosigner architectures for multi-TEE and non-TEE fallback, develop standardized attestation flows, and update customer contracts and compliance documentation. Systems affected include MPC cosigner binaries and images, enclave build pipelines and reproducible build systems, attestation and secret-injection services (e.g., Nitro KMS integrations), key-management backends that bind decryption keys to enclave identity, monitoring and logging pipelines that must remain privacy-preserving while still observing enclave health, and incident-response runbooks for TEE vulnerabilities. Impact scope: dozens of MPC wallet providers and custody platforms, hundreds of institutional clients, and an estimated 50M–100M end users indirectly protected by these architectures [Assumption]. Asset scale may exceed $50B across institutional MPC custody, exchange hot wallets, and embedded MPC wallets in financial applications [Guide: Stackup, 2025; Assumption]. A systemic TEE vulnerability or attestation PKI compromise affecting a major cloud vendor could simultaneously degrade isolation for a large share of these deployments, forcing emergency re-hosting on non-TEE infrastructure with potentially higher compromise risk or leading to prolonged downtime while patches and mitigations are validated. Conversely, over-reliance on a single TEE platform in a subset of regions creates the risk that regional outages or compliance changes (e.g., export controls on cryptographic hardware) could disproportionately affect users concentrated in those regions.
   
   - **Historical attempts and existing solutions (if any)**: 
     Early MPC wallets primarily relied on software isolation and network segmentation rather than TEEs; as TEEs matured, vendors began moving sensitive MPC components into enclaves to reduce exposure to host compromise. AWS documented an architecture where Fireblocks customer MPC cosigners run inside Nitro Enclaves, using remote attestation, KMS-bound keys, and encrypted in-memory databases synchronized to S3 or DynamoDB to protect key shards and transient data [Blog: AWS Web3, 2025-11]. Blockdaemon subsequently announced secure enclave support for its Institutional Wallet and Builder Vault, emphasizing that MPC nodes can now run in TEEs where remote attestation and secret injection ensure only trusted code receives key material [Blog: Blockdaemon, 2025-11]. Developer guides such as Alchemy’s 2025 MPC wallet overview compare TEE-based and MPC-based designs, highlighting that TEEs can offer faster signing but require trust in CPU vendors and cloud environments, and warning about pitfalls such as ignoring recovery mechanisms, latency implications, and vendor lock-in [Guide: Alchemy, 2025]. On the security side, guidance from CISA and security vendors following the disclosure of Meltdown and Spectre explained that speculative-execution vulnerabilities can expose supposedly isolated memory regions, including enclave contents, and recommended microcode and OS patches, enclave code hardening, and continuous monitoring for new variants [Advisory: CISA, 2018; Article: Anjuna, 2018]. Some operators responded by disabling vulnerable features, pinning enclave builds to specific microcode versions, or moving the most sensitive workloads back to HSMs or fully offline environments. However, there is still no widely adopted, open standard for MPC enclave attestation flows, multi-TEE portability, or fallback to hardened non-TEE deployments.
   
   - **Known facts, assumptions, and uncertainties**: 
     - **Facts**: AWS describes Fireblocks customer MPC cosigners running inside Nitro Enclaves, with enclave attestation and KMS integration used to protect key shards and transient data and to ensure only attested enclave images can decrypt secrets [Blog: AWS Web3, 2025-11]. Blockdaemon reports that its Institutional Wallet and Builder Vault now host MPC nodes inside secure enclaves (TEEs) using remote attestation and secret injection to keep sensitive data hidden from the underlying OS while providing high-throughput signing services [Blog: Blockdaemon, 2025-11]. Developer guides note that TEEs and MPC can be combined or compared as alternative approaches for wallet security, with TEEs often offering lower signing latency but introducing different trust assumptions and vendor lock-in concerns [Guide: Alchemy, 2025]. Public vulnerability advisories from CISA and others explain that Meltdown and Spectre-class speculative-execution flaws enable side-channel attacks against modern CPUs, potentially allowing leakage of protected memory and requiring coordinated microcode and OS updates [Advisory: CISA, 2018]. Security analyses specifically exploring Intel SGX conclude that enclave security depends on both microarchitectural behavior and correct use of hardened coding patterns, and that speculative-execution vulnerabilities can undermine enclave isolation unless mitigations are applied [Article: Anjuna, 2018].
     - **Assumptions**: It is assumed that a majority (60–80%) of institutional MPC wallet deployments launched in 2023–2025 place at least one MPC cosigner share inside a TEE such as Nitro Enclaves or SGX-enabled instances, based on vendor marketing materials and reference architectures but without a comprehensive industry survey. It is further assumed that 50–70% of those deployments concentrate a quorum of key shares (e.g., 2-of-3) on a single TEE platform or cloud provider, creating correlated failure modes. Estimates of 3–6 months to redesign and migrate enclave-based MPC architectures between TEE providers are based on typical secure infrastructure program timelines (threat modeling, coding, testing, certification, phased rollout) rather than hard incident data. The assumption that there are <300 engineers worldwide with deep combined expertise in MPC protocols, enclave programming, and cloud security reflects the narrow intersection of these fields inferred from conference speakers, open-source contributions, and security firm rosters. Asset-scale estimates (>$50B protected by TEE-backed MPC architectures) extrapolate from published AUM figures for major custody and MPC wallet providers and the prevalence of TEE-backed designs in institutional marketing materials.
     - **Uncertainties**: Actual adoption rates of TEEs in MPC wallet infrastructures, and the precise fraction of deployments with a quorum of key shares on a single TEE platform, are unknown due to limited public disclosure and NDA-constrained architecture details. The long-term trajectory of TEE platforms (e.g., continued investment vs. partial deprecation, as seen with SGX on some CPUs) is uncertain, as is the frequency and severity of future speculative-execution or microarchitectural vulnerabilities that might impact enclave isolation. The degree to which regulators and institutional clients will demand explicit disclosure of TEE dependencies, standardized attestation evidence, or multi-TEE fallback architectures is also unclear. It is not yet known whether open standards for MPC enclave attestation and portability will emerge and be widely adopted, or whether proprietary, cloud-specific designs will continue to dominate. Finally, the real-world impact of a major TEE vulnerability on MPC wallet providers—whether it would lead to widespread asset freezes, emergency re-hosting on non-TEE infrastructure, or coordinated mitigations with limited downtime—remains speculative, as there have been no large-scale public incidents directly tied to TEE failures in MPC wallets to date.

---

## Glossary

- **Trusted Execution Environment (TEE)**: Hardware-backed secure processing environment that isolates code and data from the host operating system, providing confidentiality and integrity guarantees through encrypted memory, restricted interfaces, and remote attestation (e.g., Intel SGX, AMD SEV, ARM TrustZone, AWS Nitro Enclaves).
- **Secure enclave**: Implementation of a TEE on a specific platform, often referring to the isolated execution context where sensitive code such as MPC cosigners run; enclaves rely on CPU microarchitecture and firmware for isolation.
- **Remote attestation**: Cryptographic protocol allowing a remote party to verify that a specific enclave image is running on genuine TEE hardware with expected configuration, typically by validating a signed measurement (PCR values) against an attestation root of trust.
- **MPC cosigner**: MPC wallet component holding one or more key shares and participating in threshold-signature protocols; often deployed inside TEEs or HSMs to protect against host compromise.
- **Secret injection**: Mechanism for securely delivering sensitive material (key shares, configuration secrets) into a TEE or enclave only after successful attestation, ensuring that secrets are never exposed to untrusted code or environments.
- **Enclave measurement (PCR)**: Hash-based representation of enclave code and configuration recorded in Platform Configuration Registers (PCRs) and used during attestation to prove that only approved binaries are running.
- **Speculative-execution side-channel vulnerability**: Class of CPU flaws (e.g., Meltdown, Spectre, Foreshadow/L1TF) where speculative execution and caching behavior leak information about protected memory, potentially undermining enclave isolation if not mitigated.
- **Platform lock-in**: Situation where MPC cosigner code, attestation flows, and KMS bindings are tightly coupled to a single TEE provider or cloud platform, making migration to alternatives slow, risky, and expensive.

---

## Reference

### Platform & Architecture Guides

- [Blog: AWS Web3, 2025-11] - "Build secure multi-party computation (MPC) wallets using AWS Nitro Enclaves" – Describes Fireblocks customer MPC cosigners running inside Nitro Enclaves, using remote attestation, KMS-bound keys, and encrypted in-memory databases synchronized to S3/DynamoDB. https://aws.amazon.com/blogs/web3/build-secure-multi-party-computation-mpc-wallets-using-aws-nitro-enclaves/
- [Blog: Blockdaemon, 2025-11] - "Elevating MPC Wallet Security: Now Enhanced with Secure Enclave Support" – Explains how Blockdaemon Institutional Wallet and Builder Vault use secure enclaves (TEEs) with remote attestation and secret injection to protect MPC nodes from host compromise. https://www.blockdaemon.com/blog/elevating-mpc-wallet-security-now-enhanced-with-secure-enclave-support

### MPC Wallet Overviews and Best Practices

- [Guide: Alchemy, 2025] - "What Is a Multi-Party Computation (MPC) Wallet? The Complete Developer Guide" – Compares MPC wallets to other wallet types, discusses TEE vs. MPC trade-offs, highlights pitfalls such as ignoring recovery, latency implications, and vendor lock-in, and outlines security best practices. https://www.alchemy.com/overviews/what-is-a-multi-party-computation-mpc-wallet
- [Guide: Stackup, 2025] - "MPC Wallets: A Complete Technical Guide" – Surveys MPC wallet protocols and deployment patterns, including institutional use cases and hardware-backed security options relevant to TEE-backed MPC cosigners. https://www.stackup.fi/resources/mpc-wallets-a-complete-technical-guide

### TEE Security & Vulnerabilities

- [Advisory: CISA, 2018] - "Meltdown and Spectre Side-Channel Vulnerability Guidance" – U.S. government advisory summarizing speculative-execution vulnerabilities affecting modern CPUs, including guidance for mitigating impacts on secure environments such as enclaves. https://www.cisa.gov/news-events/alerts/2018/01/04/meltdown-and-spectre-side-channel-vulnerability-guidance
- [Article: Anjuna, 2018] - "Meltdown & Spectre and what it means for Intel SGX" – Discusses how speculative-execution vulnerabilities impact Intel SGX enclaves, recommended hardening strategies, and limitations of enclave isolation when microarchitectural flaws are present. https://medium.com/anjuna-security/meltdown-spectre-and-what-it-means-for-intel-sgx-492ec9c8b689
